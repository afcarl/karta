import unittest
import numpy as np
import karta
from karta import RegularGrid
from karta.raster import misc

class RasterMiscTests(unittest.TestCase):

    def test_hillshade(self):
        x = np.linspace(0, np.pi, 16)
        y = np.linspace(0, np.pi, 16).reshape((-1, 1))

        g = RegularGrid([0, 0, 1, 1, 0, 0], values=np.sin(x)*np.sin(y),
                        crs=karta.crs.Cartesian)
        hs = misc.hillshade(g)

        self.assertTrue(np.allclose(hs[hs.data_mask],
            [0.84923394351971149, 0.86954042549819088, 0.88846952373817367,
             0.90556229874094718, 0.92054112351316264, 0.93323125018542952,
             0.94347531736616952, 0.95106558877757219, 0.9557056512065355,
             0.95701058871925127, 0.9545498433252626, 0.947930820190236,
             0.93691559745403474, 0.92154310110869231, 0.81137459791416255,
             0.8332067359124945, 0.85549065479455644, 0.87749061557100605,
             0.89856447456424127, 0.91813405749865651, 0.93564497802746871,
             0.95052998639231245, 0.96218952486060505, 0.96999912655120712,
             0.97335001699906021, 0.97172310349212287, 0.96478701960025059,
             0.95250108498045161, 0.77507051958324458, 0.79756999367580883,
             0.82240562952134844, 0.84858800366389575, 0.87510829111804922,
             0.90096136282393047, 0.92516035250055495, 0.94674886229055966,
             0.96481777511432698, 0.97853194146028821, 0.98717076420447625,
             0.99018202605134864, 0.98724290158925831, 0.97831599177604267,
             0.74232752226535981, 0.7645053318426106, 0.79081078207696864,
             0.82006627366172224, 0.85095107094481715, 0.88206527007118252,
             0.91199951086825481, 0.93940842312498751, 0.96307946394831778,
             0.98199094644135609, 0.99535669614567346, 1.0026521200768532,
             1.0036243268090177, 0.998288469858571, 0.71492735293648546,
             0.73573143920035888, 0.76222164167122475, 0.79312323574347232,
             0.82690212130190999, 0.86185077445499636, 0.89620451351753827,
             0.92827465193290915, 0.95657566914620273, 0.97992356534307645,
             0.9974858641908424, 1.0087798354664006, 1.0136301068780678,
             1.0121046324979899, 0.6943095433832529, 0.71269838909552585,
             0.73798656288770181, 0.76889901933433502, 0.80381062262176561,
             0.84083864511984274, 0.87798545992904209, 0.91331618685890414,
             0.94513673008778387, 0.97212749186690373, 0.99340226944371401,
             1.0084867501896251, 1.0148314678962729, 1.0148314678962729,
             0.68785706265678626, 0.69651697760231002, 0.71921994865678274,
             0.74843014090575, 0.78256052528010378, 0.81970947083997214,
             0.85780879905834795, 0.89481869204446041, 0.92893120198185231,
             0.95872546281302751, 0.98323672952247632, 1.0019304231966835,
             1.0146041370011485, 1.0148314678962729, 0.68785706265678626,
             0.68792307960321997, 0.70675578230536296, 0.7326055659285905,
             0.76404486924174209, 0.7993112489299723, 0.83644107806621781,
             0.87345102267146679, 0.90853298007185246, 0.94020975515552929,
             0.96741215454531682, 0.9894663084644002, 1.0060102906211952,
             1.0148314678962729, 0.68785706265678626, 0.68785706265678626,
             0.70111899861108395, 0.72212548479873029, 0.74912121128037856,
             0.78062211768763945, 0.81492626405292046, 0.85025699098278251,
             0.88492020265558058, 0.91743802890638015, 0.94662868328897276,
             0.97161923753214374, 0.99180043333449897, 1.0067489281190329,
             0.6938716973825485, 0.69448862364621688, 0.7025099618549786,
             0.71746734325213168, 0.73855510007903824, 0.76467303400107955,
             0.79449570593142882, 0.82656574110852654, 0.85939787707314941,
             0.89157659573934123, 0.92182997169950176, 0.94906815565015445,
             0.97238729132392576, 0.99104897694405292, 0.71404455021266644,
             0.70916086399369271, 0.71080000287498413, 0.71886226779410078,
             0.73296228681118625, 0.75244829029412652, 0.77643384651651104,
             0.80384281039238037, 0.83346243255212527, 0.86400211068858856,
             0.89415271608762026, 0.92264134087486871, 0.94827988476966796,
             0.97000549780587764, 0.74074052407028224, 0.73046315440640908,
             0.72553990647804667, 0.72628138455692948, 0.73275784295630686,
             0.74478797691257803, 0.76193736902105502, 0.78352587881105973,
             0.808644434369719, 0.83618151910811411, 0.86486409347837334,
             0.89331627719847861, 0.92013606231985856, 0.94398599626308033,
             0.77247553285194814, 0.75723884190988844, 0.74598294605115245,
             0.73943518025604216, 0.73811960397307752, 0.74230925885506738,
             0.75199725602162437, 0.76688226438646812, 0.78636472621701592,
             0.80955425596004338, 0.83529459458888045, 0.86221540765350302,
             0.8888191126928604, 0.91360200701345295, 0.80748623192083824,
             0.78806101392597283, 0.77112569565608891, 0.75778317674597484,
             0.74896574116128711, 0.74535282029575034, 0.747319217927502,
             0.75490948933890467, 0.76782722131685632, 0.78543520636737574,
             0.80677072133029026, 0.83058699210815123, 0.85543618588181669,
             0.87979538950981906]))
        return

if __name__ == "__main__":
    unittest.main()


